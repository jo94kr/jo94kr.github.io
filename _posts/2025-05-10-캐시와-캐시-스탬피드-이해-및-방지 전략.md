---
title: ìºì‹œì™€ ìºì‹œ ìŠ¤íƒ¬í”¼ë“œ ì´í•´ ë° ë°©ì§€ ì „ëµ
date: 2025-05-10 07:59:35 +0900
categories:
  - ë°±ì—”ë“œ ì•„í‚¤í…ì²˜
tags:
  - redis
  - ìºì‹œìŠ¤íƒ¬í”¼ë“œ
  - ë¶„ì‚°ë½
  - TTLì „ëµ
  - PERì•Œê³ ë¦¬ì¦˜
  - ë°±ì—”ë“œìµœì í™”
  - Javaìºì‹œ
  - ì„œë¹„ìŠ¤ì¥ì• ì˜ˆë°©
---
## ğŸ“Œ ë¬¸ì„œ ê°œìš”
**ìºì‹œ ìŠ¤íƒ¬í”¼ë“œ(Cache Stampede)**ëŠ” ë‹¤ìˆ˜ì˜ ìš”ì²­ì´ ë™ì‹œì— ìºì‹œ ë¯¸ìŠ¤ë¥¼ ì¼ìœ¼ì¼œ, ë°±ì—”ë“œ(DB ë˜ëŠ” API)ì— ê³¼ë„í•œ ë¶€í•˜ë¥¼ ì£¼ë©° ì„œë¹„ìŠ¤ ì¥ì• ë¡œ ì´ì–´ì§€ëŠ” í˜„ìƒì…ë‹ˆë‹¤.

ì´ ë¬¸ì„œì—ì„œëŠ” **ìŠ¤íƒ¬í”¼ë“œê°€ ë°œìƒí•˜ëŠ” ë°©ì‹**ê³¼ ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ **3ê°€ì§€ ì‹¤ìš©ì ì¸ ì „ëµ**ì„, Redis ê¸°ë°˜ Java ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

### ì´ ë¬¸ì„œë¥¼ í†µí•´ ì•Œ ìˆ˜ ìˆëŠ” ë‚´ìš©
- ìºì‹œì˜ ê¸°ë³¸ ë™ì‘ ì›ë¦¬ì™€ ì¥ì 
- ìºì‹œ ìŠ¤íƒ¬í”¼ë“œê°€ ë°œìƒí•˜ëŠ” ì´ìœ ì™€ êµ¬ì²´ì ì¸ ì‹œë‚˜ë¦¬ì˜¤

---

## 1. ìºì‹œ ìŠ¤íƒ¬í”¼ë“œëŠ” ì–´ë–»ê²Œ ë°œìƒí•˜ëŠ”ê°€?

### ğŸ’¥ ì „í˜•ì ì¸ ì‹œë‚˜ë¦¬ì˜¤
1. ì¸ê¸° ìƒí’ˆ APIì— ë¶„ë‹¹ ìˆ˜ì²œ ê±´ì˜ ìš”ì²­ ë°œìƒ
2. ìºì‹œ TTL(Time To Live)ì„ 5ë¶„ìœ¼ë¡œ ì„¤ì •
3. 5ë¶„ í›„ ìºì‹œ ë§Œë£Œ â†’ ëª¨ë“  ìš”ì²­ì´ ë™ì‹œì— ìºì‹œ ë¯¸ìŠ¤
4. ë°±ì—”ë“œ(DB, API ë“±)ì— ê°™ì€ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ìˆ˜ì²œ ê±´ì˜ íŠ¸ë˜í”½ ë°œìƒ
5. DB ê³¼ë¶€í•˜ë¡œ ì„œë¹„ìŠ¤ ì¥ì•  ë°œìƒ

### í•µì‹¬ ì›ì¸
- TTLì´ ê³ ì •ë˜ì–´ ìˆì–´, ìºì‹œ ë§Œë£Œ ì‹œì ì´ ì§‘ì¤‘ë¨
- ìºì‹œ ë¯¸ìŠ¤ ì‹œ ë‹¤ìˆ˜ì˜ ìš”ì²­ì´ ë™ì‹œì— ë°±ì—”ë“œë¡œ ëª°ë¦¼
- ìš”ì²­ ì œì–´ ì¥ì¹˜ ì—†ì„ ê²½ìš° íŠ¸ë˜í”½ì´ ê·¸ëŒ€ë¡œ ë°˜ì˜ë¨

---

## 2. ë°©ì§€ ì „ëµ

ìºì‹œ ìŠ¤íƒ¬í”¼ë“œë¥¼ ë§‰ê¸° ìœ„í•´ ë‹¤ìŒ 3ê°€ì§€ ì „ëµì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2.1. ë½ì„ ì´ìš©í•œ ë‹¨ì¼ ê°±ì‹ 

> í•˜ë‚˜ì˜ ìš”ì²­ë§Œ ë°±ì—”ë“œë¥¼ í˜¸ì¶œí•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ë½ í•´ì œê¹Œì§€ ëŒ€ê¸°í•˜ê±°ë‚˜ ìºì‹œë¥¼ ë‹¤ì‹œ í™•ì¸í•©ë‹ˆë‹¤.
#### ì˜ˆì‹œ (Redisson ê¸°ë°˜)
``` java
RLock lock = redissonClient.getLock("lock::goods::populer");
if (lock.tryLock(2, 10, TimeUnit.SECONDS)) {
    try {
        Object cached = redisTemplate.opsForValue().get(key);
        if (cached == null) {
            Object data = fetchFromDB();
            redisTemplate.opsForValue().set(key, data, Duration.ofMinutes(5));
            return data;
        }
        return cached;
    } finally {
        lock.unlock();
    }
} else {
    // ë‹¤ë¥¸ ìš”ì²­ì´ ê°±ì‹  ì¤‘ì´ë¯€ë¡œ ì ì‹œ í›„ ìºì‹œ ì¬í™•ì¸
    Thread.sleep(100);
    return redisTemplate.opsForValue().get(key);
}

```

#### ì¥ì 
- ì¤‘ë³µëœ ë°ì´í„° ê°±ì‹  ë°©ì§€
- ê³ ì • TTL í™˜ê²½ì—ì„œ ì•ˆì •ì 
#### ë‹¨ì 
- ë½ êµ¬í˜„ í•„ìš” (Redissonë“± í™œìš©)
- ë³‘ë ¬ ìš”ì²­ì˜ ëŒ€ê¸° ì‹œê°„ ë°œìƒ ê°€ëŠ¥

---

### 2.2. TTL ë¶„ì‚°(Randomized TTL)

> ëª¨ë“  ìš”ì²­ì´ **ê°™ì€ ì‹œì ì— ë§Œë£Œë˜ì§€ ì•Šë„ë¡**, TTLì— ë¬´ì‘ìœ„ ê°’ì„ ì¶”ê°€í•´ ë§Œë£Œ ì‹œì ì„ ë¶„ì‚°ì‹œí‚µë‹ˆë‹¤.

#### ì˜ˆì‹œ
``` java
int baseTtl = 300; // 5ë¶„
int jitter = new Random().nextInt(60); // 0~60ì´ˆ
redisTemplate.opsForValue().set(key, data, baseTtl + jitter, TimeUnit.SECONDS);
```

#### ì¥ì 
- êµ¬í˜„ì´ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì 
- TTL ì§‘ì¤‘ ë§Œë£Œë¡œ ì¸í•œ ìŠ¤íƒ¬í”¼ë“œ í™•ë¥  ë¶„ì‚°
#### ë‹¨ì 
- TTL ì˜ˆì¸¡ì´ ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìŒ
- TTLì´ ë„ˆë¬´ ì§§ìœ¼ë©´ ìºì‹œ íš¨ìš¸ ì €í•˜

### 2.3. **PER (Probabilistic Early Recomputation)**

> TTLì´ ë‹¤ ë˜ê¸° ì „ì— **í™•ë¥ ì ìœ¼ë¡œ ë¯¸ë¦¬ ìºì‹œë¥¼ ê°±ì‹ **í•©ë‹ˆë‹¤. ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê°±ì‹  í™•ë¥ ì´ ì¦ê°€í•©ë‹ˆë‹¤.

#### ì˜ˆì‹œ
``` java
public boolean shouldRefresh(long ttl, long age, double beta) {
    double probability = Math.exp(-beta * age / ttl);
    return Math.random() < probability;
}
```

- `ttl`: ìºì‹œ TTL
- `age`: ìºì‹œê°€ ì‚¬ìš©ëœ ì‹œê°„
- `beta`: ë¯¼ê°ë„ ì¡°ì ˆ ê°’ (ë³´í†µ 1~2)

#### ì¥ì 
- TTLì´ ê°™ë”ë¼ë„ ê°±ì‹  ì‹œì ì´ ë‹¤ì–‘í™”ë˜ì–´ ìŠ¤íƒ¬í”¼ë“œ ì™„í™”
- ì¼ì • í™•ë¥ ë¡œ ë¯¸ë¦¬ ê°±ì‹ í•˜ë¯€ë¡œ ì¥ì•  ê°€ëŠ¥ì„± ê°ì†Œ
#### ë‹¨ì 
- ìˆ˜í•™ ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„ í•„ìš”
- ìƒí™©ì— ë”°ë¼ íŠœë‹ í•„ìš”

## 3. ë§ˆë¬´ë¦¬

ìºì‹œëŠ” ê³ ì„±ëŠ¥ ì‹œìŠ¤í…œ êµ¬í˜„ì— í•„ìˆ˜ì ì¸ ë„êµ¬ì´ì§€ë§Œ, TTL ì„¤ì •ì´ë‚˜ ê°±ì‹  íƒ€ì´ë°ì´ ì˜ëª»ë˜ë©´ ìºì‹œ ìŠ¤íƒ¬í”¼ë“œ ê°™ì€ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
íŠ¹íˆ **ì§§ì€ TTLì„ ì‚¬ìš©í•˜ëŠ” APIë‚˜ ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ í™˜ê²½**ì—ì„œëŠ”, ë‹¨ìˆœí•œ ìºì‹±ë§Œìœ¼ë¡œëŠ” ì•ˆì •ì„±ì„ ë³´ì¥í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ì´ë•ŒëŠ” **ìºì‹œ ë¯¸ìŠ¤ê°€ ì§‘ì¤‘ë˜ì§€ ì•Šë„ë¡ ì œì–´í•˜ëŠ” ì „ëµ**ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.

